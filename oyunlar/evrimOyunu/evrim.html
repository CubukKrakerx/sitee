<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evrim Oyunu - Ultimate Evolution</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap');

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Rajdhani', sans-serif;
  background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
  color: #ffffff;
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background:
    radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(120, 255, 198, 0.2) 0%, transparent 50%);
  animation: backgroundFloat 20s ease-in-out infinite;
  z-index: -1;
}

@keyframes backgroundFloat {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  33% { transform: translateY(-10px) rotate(1deg); }
  66% { transform: translateY(10px) rotate(-1deg); }
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  display: flex;
  gap: 40px;
  align-items: flex-start;
}

.game-area {
  flex: 1;
}

.achievements-section {
  flex: 0 0 250px;
  align-self: center;
}

.header {
  text-align: center;
  margin-bottom: 30px;
  position: relative;
}

h1 {
  font-family: 'Orbitron', monospace;
  font-size: 3.5rem;
  font-weight: 900;
  background: linear-gradient(45deg, #00d4ff, #ff6b6b, #4ecdc4, #f9ca24);
  background-size: 400% 400%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradientShift 3s ease-in-out infinite;
  text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
  margin-bottom: 10px;
}

@keyframes gradientShift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

.subtitle {
  font-size: 1.2rem;
  color: #b8c5d6;
  opacity: 0.8;
}

.game-stats {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.stat-card {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  min-width: 150px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
}

.stat-label {
  font-size: 0.9rem;
  color: #b8c5d6;
  margin-bottom: 5px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.stat-value {
  font-size: 2rem;
  font-weight: 700;
  color: #00d4ff;
  text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
}

#coinDisplay {
  background: linear-gradient(45deg, #ffd700, #ffed4e);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-size: 2.5rem;
  font-weight: 900;
  text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
}

.controls {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.btn {
  padding: 15px 30px;
  font-size: 1.1rem;
  font-weight: 600;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.btn:hover::before {
  left: 100%;
}

.btn-primary {
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

.btn-success {
  background: linear-gradient(45deg, #00d4ff, #4ecdc4);
  color: white;
}

.btn-success:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
}

#grid {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  gap: 8px;
  margin: 0 auto 40px;
  width: 100%;
  max-width: 500px;
  aspect-ratio: 1;
  position: relative;
}

.cell {
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(5px);
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: 700;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.cell::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.cell:hover::before {
  opacity: 1;
}

.cell:active {
  transform: scale(0.95);
}

.cell.lvl1 {
  background: linear-gradient(135deg, #a0d8f1, #87ceeb);
  box-shadow: 0 0 20px rgba(160, 216, 241, 0.4);
}
.cell.lvl2 {
  background: linear-gradient(135deg, #6fcf97, #51cf66);
  box-shadow: 0 0 20px rgba(111, 207, 151, 0.4);
}
.cell.lvl3 {
  background: linear-gradient(135deg, #f2c94c, #f5b041);
  box-shadow: 0 0 20px rgba(242, 201, 76, 0.4);
}
.cell.lvl4 {
  background: linear-gradient(135deg, #eb5757, #e74c3c);
  box-shadow: 0 0 20px rgba(235, 87, 87, 0.4);
}
.cell.lvl5 {
  background: linear-gradient(135deg, #9b51e0, #8e44ad);
  box-shadow: 0 0 20px rgba(155, 81, 224, 0.4);
}
.cell.lvl6 {
  background: linear-gradient(135deg, #f2994a, #e67e22);
  box-shadow: 0 0 20px rgba(242, 153, 74, 0.4);
}
.cell.lvl7 {
  background: linear-gradient(135deg, #ff6b6b, #e74c3c);
  box-shadow: 0 0 20px rgba(255, 107, 107, 0.4);
}
.cell.lvl8 {
  background: linear-gradient(135deg, #4ecdc4, #16a085);
  box-shadow: 0 0 20px rgba(78, 205, 196, 0.4);
}
.cell.lvl9 {
  background: linear-gradient(135deg, #45b7d1, #3498db);
  box-shadow: 0 0 20px rgba(69, 183, 209, 0.4);
}
.cell.lvl10 {
  background: linear-gradient(135deg, #f9ca24, #f39c12);
  box-shadow: 0 0 20px rgba(249, 202, 36, 0.4);
}

.cell.merge {
  animation: mergePulse 0.6s ease-in-out;
}

@keyframes mergePulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

.cell.fade {
  animation: fadeOut 0.5s ease-in-out forwards;
}

@keyframes fadeOut {
  0% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(0.8); }
}

.cell.dragging {
  opacity: 0.7;
  transform: scale(1.1) rotate(5deg);
  z-index: 1000;
}

.cell.drag-over {
  border-color: #00d4ff;
  background: rgba(0, 212, 255, 0.3);
  box-shadow: 0 0 30px rgba(0, 212, 255, 0.6);
}



.achievements-section {
  margin-bottom: 40px;
}

.achievements-title {
  text-align: center;
  font-size: 1.2rem;
  margin-bottom: 15px;
  color: #b8c5d6;
}

#achievements {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.achievement {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 10px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  font-size: 0.85rem;
}

.achievement.unlocked {
  background: linear-gradient(135deg, rgba(76, 237, 133, 0.2), rgba(46, 204, 113, 0.2));
  border-color: #4ecd71;
  box-shadow: 0 0 20px rgba(76, 237, 133, 0.3);
}

.achievement.locked {
  opacity: 0.7;
}

@media (max-width: 768px) {
  h1 {
    font-size: 2.5rem;
  }

  .game-stats {
    gap: 15px;
  }

  .stat-card {
    min-width: 120px;
    padding: 15px;
  }

  .stat-value {
    font-size: 1.5rem;
  }

  #coinDisplay {
    font-size: 2rem;
  }

  .controls {
    gap: 10px;
  }

  .btn {
    padding: 12px 20px;
    font-size: 1rem;
  }

  #grid {
    max-width: 350px;
    gap: 6px;
  }

  .cell {
    font-size: 1rem;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 15px;
  }

  h1 {
    font-size: 2rem;
  }

  .game-stats {
    flex-direction: column;
    align-items: center;
  }

  .controls {
    flex-direction: column;
    align-items: center;
  }

  #grid {
    max-width: 300px;
  }
}
</style>
</head>
body>
  <div class="container">
    <div class="game-area">
      <header class="header">
        <h1>EVOLUTION</h1>
        <div class="subtitle">Ultimate Evolution Game</div>
      </header>

      <div class="game-stats">
        <div class="stat-card">
          <div class="stat-label">Coins</div>
          <div class="stat-value" id="coinDisplay">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Merges</div>
          <div class="stat-value" id="totalMerges">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Max Level</div>
          <div class="stat-value" id="maxLevel">0</div>
        </div>
      </div>

      <div class="controls">
        <button class="btn btn-success" id="buyCell">üõí Buy Cell (1 Coin)</button>
        <button class="btn btn-primary" id="autoAddUpgrade">ü§ñ Auto Add (100 Coins)</button>
        <button class="btn btn-primary" id="biggerGridUpgrade">üìà Bigger Grid (500 Coins)</button>
        <button class="btn btn-primary" id="multiplierUpgrade">‚ú® Multiplier (200 Coins)</button>
      </div>

      <div id="grid"></div>
    </div>

    <section class="achievements-section">
      <h2 class="achievements-title">üèÜ Achievements</h2>
      <div id="achievements">
        <div class="achievement locked" id="ach1">üéØ First Merge<br><small>Complete your first merge</small></div>
        <div class="achievement locked" id="ach2">‚≠ê Level 5 Reached<br><small>Reach evolution level 5</small></div>
        <div class="achievement locked" id="ach3">üíé 1000 Coins<br><small>Earn 1000 coins</small></div>
        <div class="achievement locked" id="ach4">üëë Level 10 Reached<br><small>Reach evolution level 10</small></div>
      </div>
    </section>
  </div>

<script>
const grid = document.getElementById('grid');
const coinDisplay = document.getElementById('coinDisplay');
const buyCellBtn = document.getElementById('buyCell');
const totalMergesDisplay = document.getElementById('totalMerges');
const maxLevelDisplay = document.getElementById('maxLevel');
const achievements = document.querySelectorAll('.achievement');
const autoAddUpgrade = document.getElementById('autoAddUpgrade');
const biggerGridUpgrade = document.getElementById('biggerGridUpgrade');
const multiplierUpgrade = document.getElementById('multiplierUpgrade');

let draggedCell = null;

// Safe localStorage helpers to avoid tampered/invalid values
function safeGetInt(key, fallback = 0, min = 0, max = 1e9) {
  try {
    const raw = localStorage.getItem(key);
    if (raw === null || raw === undefined) return fallback;
    const n = parseInt(raw);
    if (Number.isNaN(n)) return fallback;
    return Math.max(min, Math.min(max, n));
  } catch (e) { return fallback; }
}
function safeGetBool(key, fallback = false) {
  try { return localStorage.getItem(key) === 'true'; } catch (e) { return fallback; }
}
function safeGetJSON(key, fallback) {
  try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : fallback; } catch (e) { return fallback; }
}

let coins = safeGetInt('evrimCoins', 0);
let size = 8;
let cells = [];
let totalMerges = safeGetInt('evrimMerges', 0);
let maxLevel = safeGetInt('evrimMaxLevel', 0);
let multiplier = safeGetInt('evrimMultiplier', 1, 1, 1e6);
let autoAdd = safeGetBool('evrimAutoAdd', false);
let biggerGrid = safeGetBool('evrimBiggerGrid', false);
let achUnlocked = safeGetJSON('evrimAchievements', [false, false, false, false]);

const evolutionNames = ['', 'H√ºcre', 'Bakteri', 'Ameba', 'Balƒ±k', 'Kurbaƒüa', 'Ku≈ü', 'Maymun', 'ƒ∞nsanoƒülu', 'Uzaylƒ±', 'Tanrƒ±'];

// Ses efektleri
function playSound(type) {
  const audio = new Audio();
  if (type === 'merge') audio.src = 'dosyalar/sesler/acousticbreeze.mp3';
  audio.volume = 0.3;
  audio.play().catch(() => {});
}

// Grid olu≈ütur
function createGrid() {
  grid.innerHTML = '';
  cells = [];
  grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
  grid.style.gridTemplateRows = `repeat(${size}, 1fr)`;

  for(let i = 0; i < size * size; i++){
    const cell = document.createElement('div');
    cell.classList.add('cell');
    cell.dataset.lvl = 0;
    cell.addEventListener('click', () => cellClick(cell));

    // Drag and drop event listeners
    cell.addEventListener('dragstart', (e) => {
      if (cell.dataset.lvl == 0) e.preventDefault();
      else {
        draggedCell = cell;
        cell.classList.add('dragging');
      }
    });
    cell.addEventListener('dragend', () => {
      draggedCell = null;
      cell.classList.remove('dragging');
    });
    cell.addEventListener('dragover', (e) => {
      e.preventDefault();
      if (cell !== draggedCell && cell.dataset.lvl == 0) {
        cell.classList.add('drag-over');
      }
    });
    cell.addEventListener('dragleave', () => {
      cell.classList.remove('drag-over');
    });
    cell.addEventListener('drop', (e) => {
      e.preventDefault();
      cell.classList.remove('drag-over');
      if (draggedCell && cell !== draggedCell) {
        const draggedLvl = parseInt(draggedCell.dataset.lvl);
        const targetLvl = parseInt(cell.dataset.lvl);

        if (targetLvl === 0) {
          // Bo≈ü h√ºcreye ta≈üƒ±
          cell.dataset.lvl = draggedLvl;
          cell.className = draggedCell.className.replace('dragging', '').trim();
          cell.innerText = draggedCell.innerText;
          draggedCell.dataset.lvl = 0;
          draggedCell.className = 'cell';
          draggedCell.innerText = '';
        } else if (draggedLvl === targetLvl) {
          // Aynƒ± seviyede merge - √úST √úSTE KOYUNCA GELƒ∞≈ûƒ∞M!
          const newLvl = draggedLvl + 1;
          cell.dataset.lvl = newLvl;
          cell.className = `cell lvl${newLvl}`;
          cell.innerText = evolutionNames[newLvl];
          draggedCell.dataset.lvl = 0;
          draggedCell.className = 'cell';
          draggedCell.innerText = '';

          // Merge animasyonu
          cell.classList.add('merge');
          setTimeout(() => {
            cell.classList.remove('merge');
          }, 600);

          // Coin ve istatistik g√ºncelleme
          coins += Math.pow(2, newLvl - 1) * multiplier;
          totalMerges++;
          if (newLvl > maxLevel) maxLevel = newLvl;
          updateCoin();
          updateStats();
          updateAchievements();
          playSound('merge');
        }
        // Farklƒ± seviyelerde hi√ßbir ≈üey yapma
        saveGridState();
      }
    });
    cell.draggable = true;
    grid.appendChild(cell);
    cells.push(cell);
  }
  loadGridState();
}

createGrid();

// Grid durumunu kaydet/y√ºkle
function saveGridState() {
  const gridState = cells.map(c => parseInt(c.dataset.lvl));
  // Ensure gridState is serializable and not poisoned
  try { localStorage.setItem('evrimGrid', JSON.stringify(gridState)); } catch(e) { console.error('evrim: grid save failed', e); }
}

function loadGridState() {
  let gridState = [];
  try { const raw = localStorage.getItem('evrimGrid'); gridState = raw ? JSON.parse(raw) : []; } catch(e) { console.error('evrim: invalid saved grid'); gridState = []; }
  gridState.forEach((lvl, i) => {
    if (cells[i]) {
      cells[i].dataset.lvl = lvl;
      cells[i].className = lvl > 0 ? `cell lvl${lvl}` : 'cell';
      cells[i].innerText = lvl > 0 ? evolutionNames[lvl] : '';
    }
  });
}

// Coin g√ºncelle
function updateCoin(){
  coinDisplay.innerText = coins;
  try { localStorage.setItem('evrimCoins', String(coins)); } catch(e) { console.error('evrim: failed saving coins', e); }
}

// ƒ∞statistikleri g√ºncelle
function updateStats() {
  totalMergesDisplay.innerText = totalMerges;
  maxLevelDisplay.innerText = maxLevel;
  try { localStorage.setItem('evrimMerges', String(totalMerges)); } catch(e) { console.error('evrim: failed saving merges', e); }
  try { localStorage.setItem('evrimMaxLevel', String(maxLevel)); } catch(e) { console.error('evrim: failed saving maxLevel', e); }
}

// Ba≈üarƒ±mlarƒ± g√ºncelle
function updateAchievements() {
  if (totalMerges >= 1 && !achUnlocked[0]) {
    achUnlocked[0] = true;
    document.getElementById('ach1').classList.remove('locked');
    document.getElementById('ach1').classList.add('unlocked');
  }
  if (maxLevel >= 5 && !achUnlocked[1]) {
    achUnlocked[1] = true;
    document.getElementById('ach2').classList.remove('locked');
    document.getElementById('ach2').classList.add('unlocked');
  }
  if (coins >= 1000 && !achUnlocked[2]) {
    achUnlocked[2] = true;
    document.getElementById('ach3').classList.remove('locked');
    document.getElementById('ach3').classList.add('unlocked');
  }
  if (maxLevel >= 10 && !achUnlocked[3]) {
    achUnlocked[3] = true;
    document.getElementById('ach4').classList.remove('locked');
    document.getElementById('ach4').classList.add('unlocked');
  }
  try { localStorage.setItem('evrimAchievements', JSON.stringify(achUnlocked)); } catch(e) { console.error('evrim: failed saving achievements', e); }
}

// Ba≈ülangƒ±√ßta ba≈üarƒ±mlarƒ± y√ºkle
achUnlocked.forEach((unlocked, i) => {
  if (unlocked) {
    achievements[i].classList.remove('locked');
    achievements[i].classList.add('unlocked');
  }
});

// Merge mantƒ±ƒüƒ±
function cellClick(cell){
  if(cell.dataset.lvl == 0) return;
  let lvl = parseInt(cell.dataset.lvl);
  let neighbors = getNeighbors(cell);
  for(let n of neighbors){
    if(parseInt(n.dataset.lvl) == lvl){
      // Merge animasyonu
      cell.classList.add('merge');
      n.classList.add('fade');
      setTimeout(() => {
        n.classList.remove('fade');
      }, 500);

      // Merge
      lvl++;
      cell.dataset.lvl = lvl;
      cell.className = `cell lvl${lvl}`;
      cell.innerText = evolutionNames[lvl];
      n.dataset.lvl = 0;
      n.className = 'cell';
      n.innerText = '';
      coins += Math.pow(2, lvl - 1) * multiplier;
      totalMerges++;
      if (lvl > maxLevel) maxLevel = lvl;
      updateCoin();
      updateStats();
      updateAchievements();
      playSound('merge');
      saveGridState();
      break;
    }
  }
}

// Kom≈üularƒ± bul
function getNeighbors(cell){
  let idx = cells.indexOf(cell);
  let neighbors = [];
  let row = Math.floor(idx / size);
  let col = idx % size;
  let dirs = [[-1,0],[1,0],[0,-1],[0,1]];
  for(let [dr,dc] of dirs){
    let r = row + dr;
    let c = col + dc;
    if(r >= 0 && r < size && c >= 0 && c < size){
      neighbors.push(cells[r * size + c]);
    }
  }
  return neighbors;
}

// Y√ºkseltmeler
autoAddUpgrade.addEventListener('click', () => {
  if (coins >= 100 && !autoAdd) {
    coins -= 100;
    autoAdd = true;
    try { localStorage.setItem('evrimAutoAdd', 'true'); } catch(e) { console.error('evrim: failed saving autoAdd', e); }
    updateCoin();
    autoAddUpgrade.disabled = true;
  }
});

biggerGridUpgrade.addEventListener('click', () => {
  if (coins >= 500 && !biggerGrid) {
    coins -= 500;
    biggerGrid = true;
    size = 8;
    try { localStorage.setItem('evrimBiggerGrid', 'true'); } catch(e) { console.error('evrim: failed saving biggerGrid', e); }
    try { localStorage.setItem('evrimSize', String(size)); } catch(e) { console.error('evrim: failed saving size', e); }
    updateCoin();
    createGrid();
    biggerGridUpgrade.disabled = true;
  }
});

multiplierUpgrade.addEventListener('click', () => {
  if (coins >= 200) {
    coins -= 200;
    multiplier++;
    try { localStorage.setItem('evrimMultiplier', String(multiplier)); } catch(e) { console.error('evrim: failed saving multiplier', e); }
    updateCoin();
  }
});

// Adam satƒ±n alma
buyCellBtn.addEventListener('click', () => {
  if (coins >= 1) {
    coins -= 1;
    let empty = cells.filter(c => c.dataset.lvl == 0);
    if (empty.length == 0) {
      alert('üö´ No empty cells available!');
      coins += 1;
    } else {
      let randCell = empty[Math.floor(Math.random() * empty.length)];
      randCell.dataset.lvl = 1;
      randCell.className = 'cell lvl1';
      randCell.innerText = evolutionNames[1];
      saveGridState();
    }
    updateCoin();
  }
});

// Ba≈ülangƒ±√ß g√ºncellemeleri
updateCoin();
updateStats();
if (autoAdd) autoAddUpgrade.disabled = true;
if (biggerGrid) biggerGridUpgrade.disabled = true;
</script>
</body>
</html>
